{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swish-Find Jobs</title>
    <link rel="stylesheet" href="/static/Css/find_jobs.css">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
     <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>

<body class="dark-mode">

    <div class="entire-header">

        <!--MENU BIT-->
        <div class="menu-bar">
            <div class="left-side">
                <div class="hamburger" onclick="toggleMenu()">
                    &#9776;
                </div>

                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 18.149999618530273 122.0999984741211 48.349998474121094" data-asc="1.303"
                    width="122.0999984741211" height="48.349998474121094">
                    <defs />
                    <g fill="#0072ff">
                        <g transform="translate(0, 0)">
                            <path
                                d="M12.25 66.50Q9.65 66.50 8.28 65.30Q6.90 64.10 6.90 62.60Q6.90 61.30 7.85 60.35Q8.80 59.40 10.65 59.40Q11.30 59.40 12.18 59.52Q13.05 59.65 13.50 59.70Q13.45 58.40 12.93 57.25Q12.40 56.10 11.60 55.02Q10.80 53.95 10.10 53.15Q8.55 56.10 7.03 58.05Q5.50 60.00 3.70 61.75Q2.80 62.65 1.80 62.65Q1 62.65 0.50 62.07Q0 61.50 0 60.65Q0 59.65 0.70 58.80L1.35 58.00Q4.10 54.60 5.50 52.40Q6.35 50.95 7.50 48.52Q8.65 46.10 9.75 43.50Q10.70 41.30 13.70 41.30Q15.10 41.30 15.65 41.55Q16.20 41.80 16.20 42.35Q16.20 42.65 16 43.30Q15.80 43.95 15.45 44.60Q14.55 46.40 14.55 47.65Q14.55 48.40 15.08 49.30Q15.60 50.20 16.70 51.55Q18.30 53.65 19.13 55.12Q19.95 56.60 19.95 58.35Q19.95 58.85 19.85 59.75Q22.30 58.80 25.60 54.70Q26.20 54.00 26.95 54.00Q27.60 54.00 27.98 54.60Q28.35 55.20 28.35 56.25Q28.35 58.15 27.40 59.35Q24.90 62.45 22.63 63.57Q20.35 64.70 17 64.80Q15.00 66.50 12.25 66.50ZM61.60 49.95Q61.75 49.90 62.10 49.90Q62.85 49.90 63.25 50.40Q63.65 50.90 63.65 51.75Q63.65 53.30 63.05 54.17Q62.45 55.05 61.25 55.45Q58.95 56.20 56.35 56.20Q54.15 56.20 52.20 55.60Q50.75 57.95 49 60.45Q47 63.30 45.58 64.35Q44.15 65.40 42.35 65.40Q40.35 65.40 39.33 63.85Q38.30 62.30 38.05 58.75L37.80 55.10Q36.25 59.30 35.03 61.50Q33.80 63.70 32.58 64.55Q31.35 65.40 29.70 65.40Q27.65 65.40 26.48 63.80Q25.30 62.20 25.00 58.75Q24.40 51.75 24.40 46.50L24.40 44.75Q24.45 43.10 25.30 42.45Q26.15 41.80 27.85 41.80Q29.15 41.80 29.78 42.37Q30.40 42.95 30.40 44.30Q30.40 50.05 31.10 59.25Q34.50 52.10 37.35 44.35Q37.90 42.85 38.68 42.32Q39.45 41.80 40.55 41.80Q41.90 41.80 42.43 42.35Q42.95 42.90 42.95 44.30Q42.95 50.05 43.65 59.25Q46.65 54.80 48.15 52.15Q47.40 50.70 47.40 48.70Q47.40 47.00 48.15 45.40Q48.90 43.80 50.20 42.80Q51.50 41.80 53.15 41.80Q54.60 41.80 55.50 42.82Q56.40 43.85 56.40 45.80Q56.40 48.05 55.20 50.95Q57.10 50.85 60.25 50.20L61.60 49.95ZM65.85 38.55Q63.75 38.55 62.70 37.57Q61.65 36.60 61.65 34.85Q61.65 33.10 63.03 31.92Q64.40 30.75 66.45 30.75Q68.30 30.75 69.45 31.65Q70.60 32.55 70.60 34.20Q70.60 36.20 69.30 37.37Q68 38.55 65.85 38.55M65.45 65.40Q62.20 65.40 60.73 63.10Q59.25 60.80 59.25 57.00Q59.25 54.75 59.83 51.22Q60.40 47.70 61.30 44.65Q61.75 43.05 62.50 42.45Q63.25 41.85 64.90 41.85Q67.45 41.85 67.45 43.55Q67.45 44.80 66.50 49.35Q65.30 54.85 65.30 56.80Q65.30 58.30 65.70 59.10Q66.10 59.90 67.05 59.90Q67.95 59.90 69.30 58.65Q70.65 57.40 72.90 54.70Q73.50 54.00 74.25 54.00Q74.90 54.00 75.28 54.60Q75.65 55.20 75.65 56.25Q75.65 58.25 74.70 59.35Q69.75 65.40 65.45 65.40ZM80.90 66.50Q78.30 66.50 76.92 65.30Q75.55 64.10 75.55 62.60Q75.55 61.30 76.50 60.35Q77.45 59.40 79.30 59.40Q79.95 59.40 80.83 59.52Q81.70 59.65 82.15 59.70Q82.10 58.40 81.58 57.25Q81.05 56.10 80.25 55.02Q79.45 53.95 78.75 53.15Q77.20 56.10 75.67 58.05Q74.15 60.00 72.35 61.75Q71.45 62.65 70.45 62.65Q69.65 62.65 69.15 62.07Q68.65 61.50 68.65 60.65Q68.65 59.65 69.35 58.80L70 58.00Q72.75 54.60 74.15 52.40Q75 50.95 76.15 48.52Q77.30 46.10 78.40 43.50Q79.35 41.30 82.35 41.30Q83.75 41.30 84.30 41.55Q84.85 41.80 84.85 42.35Q84.85 42.65 84.65 43.30Q84.45 43.95 84.10 44.60Q83.20 46.40 83.20 47.65Q83.20 48.40 83.73 49.30Q84.25 50.20 85.35 51.55Q86.95 53.65 87.78 55.12Q88.60 56.60 88.60 58.35Q88.60 58.85 88.50 59.75Q90.95 58.80 94.25 54.70Q94.85 54.00 95.60 54.00Q96.25 54.00 96.63 54.60Q97 55.20 97 56.25Q97 58.15 96.05 59.35Q93.55 62.45 91.28 63.57Q89 64.70 85.65 64.80Q83.65 66.50 80.90 66.50ZM120.70 54.00Q121.35 54.00 121.73 54.60Q122.10 55.20 122.10 56.25Q122.10 58.25 121.15 59.35Q118.85 62.00 116.43 63.70Q114.00 65.40 110.90 65.40Q108.35 65.40 107.05 63.92Q105.75 62.45 105.75 59.65Q105.75 58.25 106.45 54.65Q107.10 51.50 107.10 50.30Q107.10 49.50 106.55 49.50Q105.90 49.50 104.70 51.17Q103.50 52.85 102.30 55.60Q101.10 58.35 100.35 61.40Q99.40 65.40 95.65 65.40Q94.15 65.40 93.68 64.32Q93.20 63.25 93.20 60.45Q93.20 58.85 93.25 57.90L93.30 53.90Q93.30 46.20 94.88 37.85Q96.45 29.50 99.53 23.82Q102.60 18.15 106.90 18.15Q109.20 18.15 110.63 20.12Q112.05 22.10 112.05 25.25Q112.05 30.30 109.10 35.72Q106.15 41.15 99.50 48.40Q99.35 51.00 99.35 53.75Q101.00 49.50 103.03 46.82Q105.05 44.15 107.03 43.00Q109.00 41.85 110.65 41.85Q113.90 41.85 113.90 45.10Q113.90 47.05 112.80 52.15Q111.85 56.50 111.85 57.90Q111.85 59.90 113.30 59.90Q114.30 59.90 115.68 58.67Q117.05 57.45 119.35 54.70Q119.95 54.00 120.70 54.00M105.85 23.10Q104.95 23.10 103.85 25.67Q102.75 28.25 101.73 32.62Q100.70 37.00 100.05 42.15Q103.15 38.50 105.18 34.20Q107.20 29.90 107.20 26.40Q107.20 24.80 106.85 23.95Q106.50 23.10 105.85 23.10Z" />
                        </g>
                    </g>
                </svg>
            </div>
            <!-- Dark overlay -->
            <div id="menu-overlay"></div>


            <div class="right-side">
                 <div class="search-container">
                    <div class="search-icon" onclick="toggleSearch()">
                        <img src="/static/images/magnifying-glass-backup-svgrepo-com.svg" alt="search">
                    </div>
                    <input type="text" id="searchInput" placeholder="Search..." oninput="showHistory()" onkeydown="handleSearch(event)" />
                    <ul id="searchHistory" class="hidden"></ul>
                </div>


                               <div class="notification-icon" onclick="toggleNotifications(this)">
                               <div class="icon">
                        <img src="/static/images/notifications-svgrepo-com.svg" alt="">
                        {% if unread_notifications_count > 0 %}
                            <span class="notification-badge">{{ unread_notifications_count }}</span>
                        {% endif %}
                    </div>
                    <div class="notifications-dropdown" id="notificationsDropdown">
                        <div class="notification-content">
                            <div class="updates-title">
                                <h1>Updates</h1>
                                {% if unread_notifications_count > 0 %}
                                    <form method="POST" action="{% url 'mark_all_notifications_read' %}" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="mark-all-read-btn">Mark all read</button>
                                    </form>
                                {% endif %}
                            </div>
                            <div class="notification-details">
                                {% for notification in notifications|slice:":20" %}
                                    <a href="{{ notification.get_link }}" 
                                    class="notification-item {% if not notification.is_read %}unread{% endif %}"
                                    onclick="markAsRead(event, {{ notification.id }})">
                                        <img src="{{ notification.sender.profile.profile_picture.url }}" 
                                            alt="pfp" 
                                            class="notif-avatar">
                                        <div class="notif-text">
                                            <p>{{ notification.get_message }}</p>
                                            <span class="notif-time">{{ notification.created_at|timesince }} ago</span>
                                        </div>
                                        {% if not notification.is_read %}
                                            <span class="unread-dot"></span>
                                        {% endif %}
                                    </a>
                                {% empty %}
                                    <p class="no-notifications">No notifications yet ðŸ””</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                

             
                <div class="icon message-icon-wrapper">
                    <img id="messagesIcon" 
                        src="/static/images/messages-1-svgrepo-com.svg" 
                        alt="messages"
                        onclick="window.location.href='{% url 'messages_list' %}'">
                    
                    {% if unread_messages_count > 0 %}
                        <span class="messages-badge">{{ unread_messages_count }}</span>
                    {% endif %}
                </div>
                
              <div class="pfp-icon">
                 <a href="{% url 'my_profile' %}">
                  <img src="{{ request.user.profile.profile_picture.url }}" alt="">
                 </a>
              </div>
            </div>
        </div>
        <!--======= FIND JOBS HEADER ===========-->
        <div class="find-jobs">
            <h5>Find Jobs</h5>
            <div class="underline"></div>
        </div>
    </div>

 
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">

    <ul>
      <li>
        <div class="ham-option">
          <a href="{% url 'home' %}">
            <div class="ham-icon">
              <img src="/static/images/home-4-svgrepo-com.svg" alt="">
            </div>
            <p>Home</p>
          </a>
        </div>
      </li>


      <li>
        <div class="ham-option">
          <a href="{% url 'find_jobs' %}">
            <div class="ham-icon">
              <img src="/static/images/job-svgrepo-com.svg" alt="">
            </div>
            <p>Find Jobs</p>
          </a>
        </div>
      </li>


      <li>
        <div class="ham-option">
          <a href="{% url 'settings' %}">
            <div class="ham-icon">
              <img src="/static/images/settings-svgrepo-com.svg" alt="">
            </div>
            <p>Settings</p>
          </a>
        </div>
      </li>

      <li>
        <div class="ham-option">
          <a href="{% url 'user_profile' request.user.username %}">
            <div class="ham-icon">
              <img src="/static/images/profile-round-1342-svgrepo-com.svg" alt="">
            </div>
            <p>Profile</p>
          </a>
        </div>
      </li>


        <li>
        <div class="ham-option">
           <a href="{% url 'logout' %}">
            <button type="submit" class="logout-btn">
            <div class="ham-icon">
                <img src="/static/images/logout-svgrepo-com.svg" alt="">
            </div>
            <p>Logout</p> 
            </button>
            </a>
            </div>
        </li>

      <div class="moon-sun-button">
        <div class="ham-icon" id="theme-toggle">
          <img id="theme-icon" src="/static/images/moon-svgrepo-com.svg" alt="toggle theme">
        </div>
      </div>


    </ul>
  </div>


    <div class="entire-jobs-page">
        <!-- ============ JOB CATEGORIES ============= -->
        <!-- Left Category Filter -->
        <div class="job-post-cat">
            <h3>Categories</h3>

            <form method="GET" class="job-cat-form" id="categoryForm" action="{% url 'find_jobs' %}">
                <div class="category-options">
                    <label class="category-btn {% if selected_category == 'all' or not selected_category %}active{% endif %}">
                        <input type="radio" name="category" value="all"
                            {% if selected_category == "all" or not selected_category %}checked{% endif %}>
                        All
                    </label>

                    {% for category in categories %}
                    <label class="category-btn {% if selected_category == category.slug %}active{% endif %}">
                        <input type="radio" name="category" value="{{ category.slug }}"
                            {% if selected_category == category.slug %}checked{% endif %}>
                        {{ category.name }}
                    </label>
                    {% endfor %}
                </div>
            </form>
        </div>


        <!--============ JOB POSTS =================-->

        <div class="job-post-grid">
           {% for job in jobs %}
            <div class="job-card" data-email="{{ job.user.email }}">
                <div class="hirer-profile">

                    <div class="hirer-icon">
                        {% if job.user.profile.profile_picture %}
                            <img src="{{ job.user.profile.profile_picture.url }}" alt="Profile Picture">
                        {% else %}
                            <img src="{% static 'images/default.jpeg' %}" alt="Default Profile Picture">
                        {% endif %}
                    </div>

                    <div class="hirer-details">
                        <h1 class="hirer-name">
                            <a href="{% url 'user_profile' username=job.user.username %}">
                                {{ job.user.get_full_name|default:job.user.username }}
                            </a>
                        </h1>

                        <h4 class="hirer-username">
                            <a href="{% url 'user_profile' username=job.user.username %}">
                                @{{ job.user.username }}
                            </a>
                        </h4>
                    </div>

                </div>

                <div class="job-title">
                    <h1>{{ job.title }}</h1>
                </div>

                <div class="job-paragraph">
                    <p>{{ job.description|truncatewords:25 }}</p>
                </div>

                <div class="job-date">
                    <p>{{ job.created_at|timesince }} ago</p>
                </div>

                <div class="job-cats">
                    {% for cat in job.categories.all %}
                        <span>{{ cat.name }}</span>
                    {% endfor %}
                </div>

                {% if request.user == job.user %}
                    <form method="POST" action="{% url 'delete_job' job.id %}" class="delete-job-form">
                        {% csrf_token %}
                        <button type="submit" class="delete-job-btn">Delete</button>
                    </form>
                {% endif %}

            </div>
            {% empty %}
                <p>No jobs found in this category.</p>
            {% endfor %}

        


            <!-- Modal -->
            <div id="jobModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>

                    <div class="modal-hirer">
                        <img id="modalHirerImg" src="" alt="">
                        <div>
                            <h2 id="modalHirerName"></h2>
                            <h4 id="modalHirerUsername"></h4>
                        </div>
                    </div>

                    <h1 id="modalJobTitle"></h1>
                    <p id="modalJobDescription"></p>
                    <p id="modalJobDate"></p>

                    <a id="applyBtn" class="apply-btn" href="#" target="_blank">Apply</a>
                </div>
            </div>


            <!--ADD JOB SIGN-->

            <!-- POST JOB BUTTON -->
            <div class="create-job-btn">
                <div class="plus-icon">
                    <img src="/static/images/heavy-plus-sign-svgrepo-com.svg" alt="">
                </div>
                <a href="#" id="postJobBtn">Post Job</a>
            </div>
                        
           <!-- CREATE JOB FORM MODAL -->
               <div id="createJobModal" class="create-job-modal">
                    <div class="create-job-modal-content">
                        <span class="close-btn">&times;</span>
                        <h2>Create a New Job</h2>

                        <form id="createJobForm" method="POST" action="{% url 'create_job' %}">
                            {% csrf_token %}
                            
                            <label>Job Title</label>
                            <input id="jobTitle" name="title" required>

                            <label>Description</label>
                            <textarea id="jobDescription" name="description" rows="3" required></textarea>

                            <label>Email</label>
                            <input id="hirerEmail" name="email" type="email" required>

                            <label>Select Categories</label>
                            <div class="category-checkboxes">
                                {% for category in categories %}
                                <label class="category-item">
                                    <input type="checkbox" name="categories" value="{{ category.id }}">
                                    {{ category.name }}
                                </label>
                                {% endfor %}
                            </div>

                            <button type="submit" class="submit-btn">Post Job</button>
                        </form>
                    </div>
                </div>




            <!-- WHERE JOB CARDS APPEAR -->
            <div id="jobList"></div>
        </div>
    </div>
{% comment %} 
    <!-- Job Modal -->
    <div id="jobModal" class="job-modal">
        <div class="job-modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-hirer-profile">
                <img id="modalHirerImg" src="" alt="">
                <div>
                    <h2 id="modalHirerName"></h2>
                    <h4 id="modalHirerUsername"></h4>
                </div>
            </div>
            <h1 id="modalJobTitle"></h1>
            <p id="modalJobDescription"></p>
            <p id="modalJobDate"></p>
        </div>
    </div> {% endcomment %}



    <script>
    // Force reload when using back/forward buttons
    window.addEventListener('pageshow', function(event) {
        if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
            window.location.reload();
        }
    });
   </script>

   <script>
    document.querySelectorAll('.category-options input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', () => {
            document.getElementById('categoryForm').submit();
        });
    });
   </script>

   

    <script src="/static/JS/find_jobs.js"></script>
</body>

</html>